var fs = require("fs");

function readChunk(filePath, bytesRead, chunkSize, callback) {
    fs.open(filePath, 'r', function (err, fd) {

        if (err) {
            callback(err, -1, null);
        }
        fs.fstat(fd, function (err, stats) {
            var maxSize = stats.size;

            var buffer;
            if (bytesRead < maxSize) {

                if ((bytesRead + chunkSize) > maxSize) {
                    chunkSize = maxSize - bytesRead;
                }
                buffer = new Buffer(chunkSize);

                fs.read(fd, buffer, 0, chunkSize, bytesRead, function (err, seekcount, buffer) {
                    callback(err, seekcount, buffer);
                });
            }
            else {
                callback("eof", -1, null);
            }
        });
    });
}

module.exports.readChunk = readChunk;